
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Claudson Oliveira</title>
  <meta name="author" content="Claudson Oliveira">

  
  <meta name="description" content="Estou engatinhando no vim, porém já venho substituído meu editor de texto principal (o sublime). Trabalhando com Drupal, muitos arquivos possuem &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cloudson.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Claudson Oliveira" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17973396-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Claudson Oliveira</a></h1>
  
    <h2>Ediscere, Scire, Agere, Vincere.</h2>
  
</hgroup>
       
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
   <li><a href="http://github.com/cloudson" target="_blank"><img src="/images/github.png" width="20px"/></a></li>
   <li><a href="http://twitter.com/cloudson" target="_blank"><img src="/images/bird_32_gray.png" width="24px"/></a></li>
   <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><img src="/images/rss.png" width="20px"/></a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cloudson.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">Sobre</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/10/15/ligando-extensoes-a-linguagens-no-vim/">Ligando Extensões a Linguagens No Vim</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-15T23:31:00-03:00" pubdate data-updated="true">Oct 15<span>th</span>, 2014</time>
        
         | <a href="/2014/10/15/ligando-extensoes-a-linguagens-no-vim/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Estou engatinhando no vim, porém já venho substituído meu editor de texto principal (o sublime). Trabalhando com Drupal, muitos arquivos possuem extensões que fogem do padrão da linguagem php, então nesse pequeno post mostro como dizer pro editor que a extensão X refere-se à linguagem Y.</p>

<p>Primeiramente criarei um arquivo de configuração de nome .vimrc na home do meu usuário local.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="err">&quot;</span> em ~/.vimrc
</span><span class='line'>
</span><span class='line'>autocmd BufRead,BufNewFile <span class="se">\*</span>.module <span class="nb">set </span><span class="nv">filetype</span><span class="o">=</span>php
</span></code></pre></td></tr></table></div></figure>


<p>Com essa linha estamos executando um comando automaticamente no vim assim que lermos ou abrirmos um arquivo que termina com <strong>.module</strong>, esse comando seta o editor dizendo que o tipo de arquivo é um php.
Como executar esse arquivo a cada chamada do vim ? Vamos chamá-lo no arquivo /etc/vim/vimrc no debian</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot; final do arquivo /etc/vim/vimrc</span>
</span><span class='line'>
</span><span class='line'><span class="s2">. &quot;</span>~/.vimrc<span class="err">&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pronto! :)
Este post é mais uma daquelas dicas rápidas que seguem de lembrete pra mim. Caso você descubra uma forma mais legal de resolver o problema, não deixe de comentar. Abraços.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/09/06/streams-em-php/">Streams Em PHP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-06T20:26:00-03:00" pubdate data-updated="true">Sep 6<span>th</span>, 2014</time>
        
         | <a href="/2014/09/06/streams-em-php/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Estudantes da Certificação PHP já leram, temeram ou irão em algum momento ouvir falar de streams em php.<br/>
Neste post vamos tentar desmistificar a dificuldade ao redor do assunto.
A motivação pra escrever sobre, surgiu de uma conversa que tivemos no <a href="http://valor.com.br">Valor</a>, um amigo apresentou o tema, e achei interessante replicá-lo aqui.</p>

<h3>O que são streams</h3>

<p>Provavelmente você já manipulou arquivos em php, operações como abrir ou escrever num arquivo se tornam simples com as funções herdadas do C.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// abre um arquivo gerando um recurso manipulável</span>
</span><span class='line'><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;meuarquivodeteste&quot;</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// escreve no arquivo associado ao recurso </span>
</span><span class='line'><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="s2">&quot;Isso é um teste&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// fecha o arquivo </span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Mas se pararmos pra pensar, essas operações de manipulação de recursos (abrir, ler, escrever, buscar&hellip;) podem ser usadas não só em arquivos locais, mas em arquivos que podem ser acessados via http, por exemplo:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// lendo um arquivo servido via http(s) </span>
</span><span class='line'><span class="nv">$pathGist</span> <span class="o">=</span> <span class="s2">&quot;https://gist.githubusercontent.com/cloudson/6372b6907e298abb4c26/raw/fce2fb435326ca1d43b0ce0b1fe51599abf2ca9f/exemplo.txt&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$pathGist</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$string</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tendo em vista essa semelhança, qualquer recurso que possa ter essas operações pode ser chamada de um(a) <strong>stream</strong> em php. Assim como fizemos via http, podemos utilizar essas mesmas funções em outros <em>contextos</em>.</p>

<h3>Contextos</h3>

<p>A linguagem já possui suporte para trabalhar com streams em certos contextos, alguns deles:</p>

<ul>
<li>file:// &ndash; Acesso local</li>
<li><a href="http://">http://</a> &ndash; Acesso via http(s)</li>
<li><a href="ftp://">ftp://</a> &ndash; Acesso via ftp(s)</li>
<li>php:// &ndash; Acesso I/O da linguagem</li>
<li>ssh2:// &ndash; Acesso via ssh2</li>
</ul>


<p>Perceba que o reconhecimento de contexto é feito automaticamente pela função que gera o recurso stream. A omissão do contexto indica o uso de file:// .</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// abrindo um arquivo local</span>
</span><span class='line'><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;file://meuarquivo&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Contexto php://</h4>

<p>Também como herança do C, afirmar que imprimir algo na tela é o mesmo que escrever no arquivo STDOUT (Standard output) é verídico em php. Esse &ldquo;arquivo&rdquo; é acessado via protocolo php://</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// o mesmo que dar um echo na tela</span>
</span><span class='line'><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;php://stdout&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="s2">&quot;olá mundo&quot;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Alguns arquivos disponíveis por esse protocolo são:</p>

<ul>
<li>stdin &ndash; Usado para entrada de dados (read-only).</li>
<li>stdout &ndash; Usado para saída de dados (write-only).</li>
<li>stderr &ndash; Usado para saída de erros (por padrão a saída de erros é o mesmo que o stdout (write-only).</li>
<li>input &ndash; Utilizado para entrada de dados, via request, por exemplo se um post é enviado com um arquivo. É possível recuperá-lo via esse arquivo.</li>
<li>memory &ndash; Escrita e leitura de dados temporários em memória.</li>
<li>temp &ndash; Escrita e leitura em arquivo temporário físico no S.O (arquivo salvo em sys_get_temp_dir() )</li>
</ul>


<h4>Contexto compress.zlib://</h4>

<p>Há uma leve diferença entre os termos compactação e compressão de dados. Compactar quer dizer unir vários arquivos num só, como é possível usando o formato tar. Comprimir quer dizer que um algoritmo foi aplicado num arquivo de tal forma que seu tamanho foi minimizado. O gzip é um famoso algoritmo de compressão de dados.
Com esse contexto podemos ler arquivos comprimidos com gzip, e é o que faremos a seguir.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># criando um arquivo comprimido</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;olá&quot;</span> &gt;&gt; <span class="nb">test</span>
</span><span class='line'>gzip <span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// lê o arquivo comprimido </span>
</span><span class='line'><span class="nv">$h</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;compress.zlib://test.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$content</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$content</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Contexto zip://</h4>

<p>Como o zip é um algortimo de compressão que pode servir como compactador de arquivos, pode existir a necessidade de ler um arquivo dentro de um zip. É o que veremos abaixo:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// lê um arquivo dentro do gzip</span>
</span><span class='line'><span class="nv">$h</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;zip://test.gz#file1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$content</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$content</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Criando um contexto</h3>

<p>A função <em>stream_context_create</em> cria um stream context em php. É questão de prova utiliza-la para mudar o comportamento padrão de alguma função.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Um post será enviado para a url, ao invés do padrão get</span>
</span><span class='line'><span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">([</span>
</span><span class='line'>   <span class="s2">&quot;http&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;method&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;post&quot;</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// perceba que o quarto parâmetro do fopen é um contexto</span>
</span><span class='line'><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;http://gist.githubusercontent.com/cloudson/6372b6907e298abb4c26/raw/fce2fb435326ca1d43b0ce0b1fe51599abf2ca9f/exemplo.txt&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
</span><span class='line'><span class="nv">$content</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$content</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Wrappers</h3>

<p>A mágica não para por ae. Você pode encapsular sua própria forma de lidar com arquivos sob um protocolo, criando um <strong>wrapper</strong> .
Você deve escrever uma classe Wrapper que segue uma certa interface/sinópse:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// declarando uma classe que diz como manipular arquivos. </span>
</span><span class='line'><span class="k">class</span> <span class="nc">YourStreamWrapper</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">public</span> <span class="k">function</span> <span class="nf">stream_open</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">,</span> <span class="nv">$options</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$opened_path</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">public</span> <span class="k">function</span> <span class="nf">stream_read</span><span class="p">(</span><span class="nv">$count</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">public</span> <span class="k">function</span> <span class="nf">stream_write</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">public</span> <span class="k">function</span> <span class="nf">stream_tell</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">public</span> <span class="k">function</span> <span class="nf">stream_eof</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">function</span> <span class="nf">stream_seek</span><span class="p">(</span><span class="nv">$offset</span><span class="p">,</span> <span class="nv">$whence</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// usando a classe num novo protocolo declarado cloud:// </span>
</span><span class='line'><span class="nx">stream_wrapper_register</span><span class="p">(</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;YourStreamWrapper);</span>
</span><span class='line'>
</span><span class='line'><span class="s2">// você poderá usar fopen(&quot;</span><span class="nx">cloud</span><span class="o">://</span><span class="nb">file</span><span class="s2">&quot;,  &quot;</span><span class="nx">r</span><span class="s2">&quot;) ... :) </span>
</span></code></pre></td></tr></table></div></figure>


<p>Imagina que lindo poder ler arquivos do dropbox ou google drive utilizando a função fopen.
Criando wrappers específicos isso seria possível.</p>

<h3>Outras possibilidades</h3>

<p>Existem diversas funções sobre stream que facilitam a vida na hora de querer um certo comportamento.
É possível usar a <a href="http://php.net/manual/en/function.stream-context-set-default.php">stream_context_set_default</a> para declarar o protocolo padrão de stream, sobescrevedo o file:// . Definir o timeout de &ldquo;conexão&rdquo; com <a href="http://php.net/manual/en/function.stream-set-timeout.php">stream_set_timeout</a>.
Ou uma das coisas mais legais, na minha opinião, copiar conteúdo de arquivos entre streams com <a href="http://php.net/manual/en/function.stream-copy-to-stream.php">stream_copy_to_stream</a>.</p>

<h3>Conclusão</h3>

<p>Espero que depois do post não haja o que temer no assunto. Nele vimos o que são e a facilidade de trabalharmos com recursos stream, e como os utilizamos o tempo todo sem nem perceber.</p>

<h4>Fontes</h4>

<ul>
<li><a href="http://php.net/manual/en/wrappers.php">Protocolo e Wrappers de streams</a></li>
<li><a href="http://php.net/manual/en/class.streamwrapper.php">Class Wrapper como sinópse</a></li>
<li><a href="http://pt.wikipedia.org/wiki/Zlib">Zlib</a></li>
<li><a href="http://en.wikipedia.org/wiki/Tar_%28computing%29">Arquivos tar</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/08/12/entendendo-uma-negociacao-de-conteudo-via-cartas/">HTTP - Entendendo Uma Negociação De Conteúdo via Cartas</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-12T22:17:00-03:00" pubdate data-updated="true">Aug 12<span>th</span>, 2014</time>
        
         | <a href="/2014/08/12/entendendo-uma-negociacao-de-conteudo-via-cartas/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Atualmente é quase impossível implementar um sistema sem estabelecer conexão com outros sistemas, uma arquitetura orientada a serviços é cada vez mais valorizada.
Hoje vamos falar um pouco sobre uma das características básicas do http e/ou de serviços sob a filosofia REST; <em>Content Negotiation</em>.</p>

<h2>A brincadeira</h2>

<p>Duas pessoas poliglotas resolvem trocar cartas em quaisquer idiomas que domiman, elas só precisam informar no envelope em que idioma a resposta deve ser enviada.</p>

<h3>Caso 1: Tudo ou nada</h3>

<p>João envia uma primeira carta para Maria perguntando como está seu novo emprego, seu envelope contém a informação</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Accept-Language: pt-BR
</span></code></pre></td></tr></table></div></figure>


<p>Recebida a carta, Maria entende que João aceita uma carta de resposta em português do Brasil, o que não é problema para uma mineira.
Ela envia a resposta e coloca no envolope</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Content-Language: pt-BR
</span></code></pre></td></tr></table></div></figure>


<p>Ou seja, ela está confirmando que sua carta de resposta está em tal língua.</p>

<h3>Caso 2: Várias Opções de línguas</h3>

<p>João resolve testar os conhecimentos de Maria e envia uma carta com o seguinte envelope</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Accept-Language: fr; q=1.0, en-US; q=0.3, pt-BR; q=0.2
</span></code></pre></td></tr></table></div></figure>


<p>Nesse envelope a informação de linguagem segue um padrão maluco que informa  <br/>
fr; q=1.0 &ndash; Me responda em francês, num ranking de fluência, eu dou 100% de importância pra ela.<br/>
en-US; q=0.3  &ndash; Se não falar francês, pode me responder em inglês americano.<br/>
pt-BR; q=0.2 &ndash; Por fim, me responda em português brasileiro mesmo ¬¬</p>

<p>Maria não fala francês e como viu que a segunda língua mais relevante pra João é o inglês, que domina, ela retorna</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Content-Language: en-US
</span></code></pre></td></tr></table></div></figure>


<h3>Caso 3: Línguas desconhecidas</h3>

<p>Num terceiro momento João envia uma carta pra maria pedindo uma resposta em chinês</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Accept-Language: zh
</span></code></pre></td></tr></table></div></figure>


<p>Mas &hellip; Maria não sabe falar essa língua e como ela não pode deixar João esperando, responde no envolope</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Status: 406
</span></code></pre></td></tr></table></div></figure>


<p>O campo de status fala sobre a resposta, nesse caso (<a href="http://httpstatus.es/406">406</a>), Maria informou que não consegue responder nessa língua.</p>

<h2>Cliente e Servidor</h2>

<p>Nos casos acima, João é o cliente, pode ser um navegador web, mas é mais interessante pensarmos genericamente num client consumindo uma api. Maria é o servidor que está expondo/servindo uma api.
As mensagens em questão são <em>requests</em> e <em>responses</em> HTTP, e o envelope representa na verdade um cabeçaho do protocolo.</p>

<h3>Negociação de conteúdo sobre mime-types</h3>

<p>O caso mais usado sobre negociação de conteúdo em serviços fala sobre tipos. Você pode/deve desenvolver uma api que serve, transparentemente, conteúdos em mime-types diferentes, pelo menos em xml e json. A estória é a mesma, porém os cabeçalhos usado são <em>Accept</em>/<em>Content-type</em>. Veja um exemplo:</p>

<p>Request:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Accept: application/json; q=1.0, text/html; q=0.5; */*; q=0.1
</span></code></pre></td></tr></table></div></figure>


<p>Response:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Status: 200
</span><span class='line'>Content-type: application/json
</span></code></pre></td></tr></table></div></figure>


<p>O Client pediu conteúdo em json ou html ou qualquer merda haha. <br/>
A aplicação, serviu um json.</p>

<h3>Conclusão</h3>

<p>Como vimos, a negociação de conteúdo é um mecanismo do http para que uma aplicação sirva um conteúdo (ou melhor, uma representação de um recurso) de modo que o cliente entenda, pode haver negociação sobre tipos (quero que você me sirva uma imagem ao invés de um json), sobre linguagens (quero essa página em inglês), sobre encodings e charsets.<br/>
Algumas (muitas) APIs fazem negociação de tipo via url, inserindo uma extensão (eu mesmo já <a href="http://phartitura.com/Guzzle/Http.png">fiz</a> <a href="http://phartitura.com/Guzzle/Http.json">isso</a>). Há bastante discussão sobre, não é a melhor maneira de se fazer, mas é a forma mais fácil e acessível via browser/humanos mais leigos. <br/>
Espero poder voltar e falar um pouco sobre status code, que é algo simples que muitas APIs importantes não respeitam.</p>

<h3>Referências</h3>

<p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec12.html">RFC 2616</a><br/>
<a href="http://en.wikipedia.org/wiki/Content_negotiation">Wikipedia</a><br/>
<a href="http://httpstatus.es/">HTTP status</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/08/11/olhar-urbano-01/">Olhar Urbano 01</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-11T23:08:00-03:00" pubdate data-updated="true">Aug 11<span>th</span>, 2014</time>
        
         | <a href="/2014/08/11/olhar-urbano-01/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>São Paulo é uma cidade que fala com a gente. Passamos por manifestações com pressa, sempre atrasados.
Já faz alguns meses que venho colecionando imagens da cidade, muitas vezes de paredes pintadas. Resolvi exibi-las aqui no blog
aos poucos.</p>

<p><img src="/images/olharurbano/01.jpg" alt="" /></p>

<p>Essa imagem mostra uma crítica forte sobre as pichações da cidade. Enquanto todos afirmam que 1 + 1 = 3, apenas o pichação diz a verdade, uma verdade não
aceita e julgada.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/23/gitql-do-que-e-feito/">Gitql - Do Que é Feito?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-23T09:02:00-03:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2014</time>
        
         | <a href="/2014/04/23/gitql-do-que-e-feito/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>No começo do ano, um projeto bem legal apareceu no github, o <a href="https://github.com/dinedal/textql">textql</a>. Aquilo me fez pensar novamente &ldquo;Como não tive essa ideia?&rdquo;; Baseado num texto csv, poder fazer consultas sql. Simplesmente incrível.<br/>
Depois de dar uma olhada no projeto, voltei ao trabalho; códigos, git status, git commit, git log &hellip; &ldquo;Hey! Todo mundo sabe sql, mas nem todo mundo sabe git log&rdquo;, e daí pensei em criar o <a href="https://github.com/cloudson/gitql">gitql</a>, uma forma fácil de extrair informações de repositórios git usando uma linguagem de consulta.</p>

<h3>Desafios</h3>

<p>Olhei um pouco mais de perto o que o textql fazia. Como seu objetivo era ler um arquivo aparentemente imutável, a ferramenta primeiramente criava um banco sqlite e importava todos os dados para uma tabela. &ldquo;Não bom&rdquo; para meu caso. Repositórios git mudam a todo momento, uma suposta tabela de commits não iria parar de crescer. Ter um banco sqlite para cada repositório e sincronizá-lo antes de cada consulta estava fora de cogitação.<br/>
O que eu queria realmente era transformar o commando <code>select * from commits</code> em <code>git log</code>, ou seja, traduzir uma linguagem em outra.
Além disso, percebi que era uma boa hora para estudar &ndash; na prática &ndash; uma linguagem emergente; <a href="http://golang.org/">golang</a>.</p>

<h3>Enfrentando o terceiro dragão</h3>

<p>Para quem me conhece desde a época (não tão distante) da faculdade, sabe que sou um pouco viciado em Teoria de compiladores, linguagens e outras coisas malucas. É uma área meio conturbadora, tanto que um compilador acaba tendo um <a href="http://www.amazon.com/Compilers-Principles-Techniques-Tools-Edition/dp/0321486811">dragão</a> como símbolo. Mas como eu (junto a amigos) já tinha feito um <a href="https://github.com/cloudson/Bocejo">compilador de mini-java para assembly mips</a>, e um tcc que tinha um <a href="http://www.gcg.ufjf.br/cloudblocks/">interpretador de C para javascript</a>, toda a teoria ainda estava na minha cabeça (em algum lugar).</p>

<h3>Definindo a linguagem</h3>

<p>Gitql é somente leitura, então o interpretador acabaria rodando apenas comandos select, escrevi alguns exemplos úteis, como objetivo final.</p>

<p><code>select * from commits</code><br/>
<code>select author, message where (date &gt;= '2014-04-10' and date &lt; '2014-04-11') and (author = 'cloudson' or author = 'jeanpimentel')</code>
<code>select author, message where 'Fuck' in full_message</code>
&hellip;</p>

<p>Alguns casos eram tão específicos que eu mesmo não conseguiria gerar um git log com tal informação, o que me animava.
Definida as palavras chaves (ficaram de fora coisas como joins, alias e  group by), era hora de implementar as fases do compilador que tinham como objetivo gerar a <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>.</p>

<h3>Como a coisa funciona mais abaixo?</h3>

<p><strong>select author from commits</strong><br/>
Por padrão temos um limite de 10 linhas, então o que fazemos é percorrer pelos últimos commits (utilizando <a href="https://github.com/libgit2/">libgit2</a>) e quando tivermos 10 sucessos, paramos. A cada sucesso guardamos author, que é <a href="https://github.com/cloudson/gitql/blob/64ab944ad750a6da26456136f9c40b2a616534f8/runtime/runtime.go#L344">transcrito para objeto commit.Author.Name</a>.</p>

<p><strong>select hash from commits where author = &lsquo;cloudson&rsquo; or author = &lsquo;jeanpimentel&rsquo;</strong>  <br/>
A heurística é a mesma mas vamos agora observar o que é um <strong>sucesso</strong>. Percorrendo os commits procuramos aqueles que casam complementamente com o where, ou seja, um sucesso é um commit que possui um dos dois autores.</p>

<p><strong> select message from commits order by date asc limit 2 </strong><br/>
Neste caso queremos os 2 primeiros commits de um repositório. Qual o problema deste exemplo? A princípio eu não tenho uma coleção de commits alocada em memória, tudo que vimos até agora é um algoritmo que vai montando uma coleção a medida que encontra sucessos. Isso nos dá uma limitação, a forma para resolver essa consulta seria <br/>
1º) Encontrando <strong>todas</strong> as mensagens de commits com sucesso.<br/>
2º) Ordenando essas mensagens (poderia ser por nome de author).<br/>
3º) Pegando apenas as 2 primeiras linhas.</p>

<p>Isso faz com que o algoritmo se torne menos eficiente (no tempo e no espaço) é o que tentei relatar na <a href="https://github.com/cloudson/gitql/issues/4">issue #4</a>.
Aparentemente não há outra forma, para que o order by funcione perfeitamente.</p>

<h3>Conclusão</h3>

<p>Valeu a pena todos os commits de madrugada para tentar finalizar a ferramenta, e também por estudar mais go, fazia tempos que eu não achava uma linguagem tão divertida. <br/>
Também é <del>du caralho</del> gratificante receber 500 stars por uma ideia maluca. Divulgando no <a href="https://twitter.com/cloudson/status/455886564787519488">twitter</a> e no <a href="http://www.reddit.com/r/golang/comments/2334ys/gitql_a_git_query_language_built_with_golang/">reddit</a> gerou-se um movimento inesperado de <a href="https://twitter.com/search?q=gitql&amp;src=typd&amp;f=realtime">pessoas</a> <a href="http://www.reddit.com/r/git/comments/234e8y/gitql_a_git_query_language/">interessadas</a> no <a href="http://ruby5.envylabs.com/episodes/494-episode-457-april-18th-2014">projeto</a>. Insano!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/10/15/ligando-extensoes-a-linguagens-no-vim/">Ligando extensões a linguagens no Vim</a>
      </li>
    
      <li class="post">
        <a href="/2014/09/06/streams-em-php/">Streams em PHP</a>
      </li>
    
      <li class="post">
        <a href="/2014/08/12/entendendo-uma-negociacao-de-conteudo-via-cartas/">HTTP - Entendendo uma negociação de conteúdo via cartas</a>
      </li>
    
      <li class="post">
        <a href="/2014/08/11/olhar-urbano-01/">Olhar urbano 01</a>
      </li>
    
      <li class="post">
        <a href="/2014/04/23/gitql-do-que-e-feito/">Gitql - Do que é feito?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/cloudson">@cloudson</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'cloudson',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Claudson Oliveira -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cloudsonblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>









</body>
</html>
